#{extends 'main.html' /}
#{set title:'Home' /}

<script>
    var krest = new Image(94, 94);
    krest.src = '/public/images/krest.png';
    var zero = new Image(94, 94);
    zero.src = '/public/images/null.png';
    var dummy = new Image(94, 94);
    dummy.src = '/public/images/empty.png';

    $(function () {
                var socket = new WebSocket("@@{Games.ticTacToe}");

                socket.onmessage = function (event) {
                    var incomingMessage = event.data;
                    showMessage(incomingMessage);
                };

                socket.onopen = function () {
                    socket.send('${firstId}');
                    socket.send('${secondId}');
                };

                function showMessage(message) {
                    var object = JSON.parse(message);
                    var field = object.field;
                    var table = $("#game-pole")[0];
                    for (var i = 0; i < field.length; i++) {
                        for (var j = 0; j < field[i].length; j++) {
                            var myImage = new Image(94, 94);
                            if (field[i][j] == '-') {
                                myImage.src = '/public/images/empty.png';
                            } else if (field[i][j] == 'o') {
                                myImage.src = '/public/images/null.png';
                            } else {
                                myImage.src = '/public/images/krest.png';
                            }
                            $(table.rows[i].cells[j]).empty();
                            table.rows[i].cells[j].appendChild(myImage);
                        }
                    }
                    if (object.state != 'PLAY') {
                        $('.result').html(object.message);
                    }
                    //TODO: исправить это
                    if (object.state == 'OVER') {
                        $('.result').html('Игра окончена! Победитель: ' + object.winner);
                    }
                }
            }
    );

</script>

<div id="field">
    <table id="game-pole">
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</div>
<div class="result"></div>